<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoodTime - Login</title>

    <!-- Hojas de estilo y fuentes externas -->
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- Rutas gestionadas por Thymeleaf -->
    <link rel="stylesheet" th:href="@{/styles/login.css}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>

    <!-- Este es el contenedor principal que centra todo en la pantalla. -->
    <div class="container">
      <!-- ======================================================= -->
      <!-- SECCIÓN IZQUIERDA: EL FORMULARIO DE LOGIN               -->
      <!-- En móvil, esta es la única sección visible inicialmente. -->
      <!-- ======================================================= -->
      <div class="login-section">
        <h1>Inicio de Sesión</h1>
        <!-- 
              El formulario envía los datos al endpoint /login.
              Thymeleaf se encarga de generar la URL correcta con th:action.
              Spring Security se encargará de procesar esta petición.
            -->
        <form th:action="@{/login}" method="post">
          <!-- Token de protección CSRF -->
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />

          <!-- Campo para el nombre de usuario o correo -->
          <label for="usuario">Usuario o correo electrónico</label>
          <div class="input-container">
            <input type="text" name="usuario" id="usuario" required />
            <i class="bx bxs-user"></i>
          </div>

          <!-- Campo para la contraseña -->
          <label for="contrasena">Contraseña</label>
          <div class="input-container">
            <input type="password" name="contrasena" id="contrasena" required />
            <i class="bx bxs-lock-alt"></i>
          </div>
          <!-- Muestra el mensaje de error de login si existe -->
          <p th:if="${error}" class="login-error" th:text="${error}"></p>

          <button type="submit">Iniciar Sesión</button>

          <!-- 
                  Este enlace de registro solo es visible en pantallas pequeñas,
                  gracias a las reglas en login.css.
                -->
          <p class="register-link-mobile">
            ¿No tienes una cuenta? <a th:href="@{/register}">Regístrate aquí</a>
          </p>
        </form>
      </div>

      <!-- ============================================================= -->
      <!-- SECCIÓN DERECHA: BIENVENIDA Y REGISTRO (SOLO EN ESCRITORIO)   -->
      <!-- Esta sección está oculta en móvil por CSS (display: none).   -->
      <!-- ============================================================= -->
      <div class="register-section">
        <img th:src="@{/images/logo_negro.png}" alt="logo" />
        <h2>Bienvenido a Good Time</h2>
        <p id="p1">
          Cambia horas perdidas por metas cumplidas. Aprende, crea, crece, y
          desconéctate de lo que no suma.
        </p>
        <p id="p2">Crea tu cuenta y súmate</p>
        <a th:href="@{/register}" class="btn-register">Registrarse</a>
      </div>
    </div>
    <!-- SCRIPT PARA ACTIVAR EL LOADER EN LA SIGUIENTE PÁGINA -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.querySelector('.login-section form');
        if (loginForm) {
          loginForm.addEventListener('submit', function() {
            // Justo antes de que el formulario se envíe, dejamos una señal
            // para que la siguiente página sepa que debe mostrar el loader.
            sessionStorage.setItem('isLoading', 'true');
          });
        }
      });
    </script>

  </body>
</html>
