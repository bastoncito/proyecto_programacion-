<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <body>
    <!-- Fragmento de la animacion de carga (Versión Definitiva) -->
    <div th:fragment="loadingScreen">
      <div id="loader-wrapper">
        <div class="loader"></div>
      </div>

      <!--
        Este script se ejecuta INMEDIATAMENTE después de que 'loader-wrapper' es parseado.
        Su única misión es mostrar el loader si venimos de una navegación.
        NO se espera a que el DOM esté completo.
      -->
      <script>
        (function() {
          if (sessionStorage.getItem('isLoading') === 'true') {
            document.getElementById('loader-wrapper').style.display = 'flex';
            // Limpiamos la bandera para que un refresco (F5) no reactive el loader.
            sessionStorage.removeItem('isLoading');
          }
        })();
      </script>
    </div>

    <!-- Fragmento de la barra de navegación -->
    <nav th:fragment="navbar" class="bottom-nav">
      <!-- Enlace a Home -->
      <a
        th:href="@{/home}"
        th:classappend="${activePage == 'home' ? 'active' : ''}"
      >
        <i class="bx bxs-home"></i>
        <span>Home</span>
      </a>

      <!-- Enlace a Historial -->
      <a
        th:href="@{/historial}"
        th:classappend="${activePage == 'historial' ? 'active' : ''}"
      >
        <i class="bx bx-history"></i>
        <span>Historial</span>
      </a>

      <!-- Enlace a Ranking -->
      <a
        th:href="@{/ranking}"
        th:classappend="${activePage == 'ranking' ? 'active' : ''}"
      >
        <i class="bx bxs-bar-chart-alt-2"></i>
        <span>Ranking</span>
      </a>

      <!-- Enlace a Perfil -->
      <a
        th:href="@{/perfil}"
        th:classappend="${activePage == 'perfil' ? 'active' : ''}"
      >
        <i class="bx bxs-user"></i>
        <span>Perfil</span>
      </a>

      <!-- Enlace a Admin (SOLO PARA ADMINS/MODS) -->
      <a
        sec:authorize="hasAnyRole('ROLE_ADMIN', 'ROLE_MODERADOR')"
        th:href="@{/admin}"
        th:classappend="${activePage == 'admin' ? 'active' : ''}"
      >
        <i class="bx bxs-cog"></i>
        <span>Gestión</span>
      </a>
    </nav>
  </body>
</html>
