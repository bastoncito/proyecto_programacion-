<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Historial y Resúmenes</title>

    <link rel="stylesheet" th:href="@{/styles/historial_tareas.css}" />
    <link rel="stylesheet" th:href="@{/styles/navbar.css}" />
    <link rel="stylesheet" th:href="@{/styles/loader.css}" />

    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script th:src="@{/js/loader-init.js}"></script>
  </head>
  <body>
    <!-- Pantalla de carga -->
    <div th:replace="~{fragments :: loadingScreen}"></div>

    <main class="grid-container">
      <!-- Columna izquierda para escritorio -->
      <div class="left-column">
        <!-- Tarjeta de Historial Completo -->
        <section class="card history-card">
          <div class="card-header">
            <h1>Historial Completo</h1>
          </div>
          <div class="card-body">
            <div
              th:if="${#lists.isEmpty(historialTareas)}"
              class="history-empty"
            >
              <i class="bx bx-ghost"></i>
              <p>
                Aún no has completado ninguna tarea. ¡El historial está vacío!
              </p>
            </div>
            <div
              th:unless="${#lists.isEmpty(historialTareas)}"
              class="history-list-container"
            >
              <div class="param-bar">
                <span>Tarea</span>
                <span>Experiencia</span>
                <span>Fecha de Finalización</span>
              </div>
              <div class="history-list">
                <div class="history-row" th:each="tarea : ${historialTareas}">
                  <span th:text="${tarea.nombre}">Nombre de la tarea</span>
                  <span class="exp-points" th:text="'+' + ${tarea.exp} + ' XP'"
                    >+100 XP</span
                  >
                  <span
                    th:text="${#temporals.format(tarea.fechaCompletada, 'dd/MM/yyyy HH:mm')}"
                    >10/10/2025 15:30</span
                  >
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Tarjeta de Resúmenes -->
        <section class="card summaries-card">
          <div class="card-header">
            <h1>Resúmenes</h1>
            <div class="historial-tabs">
              <a
                href="javascript:void(0);"
                id="tab-semanal"
                class="active"
                data-no-loader
                onclick="mostrarResumen('semanal')"
                >Semanal</a
              >
              <a
                href="javascript:void(0);"
                id="tab-mensual"
                data-no-loader
                onclick="mostrarResumen('mensual')"
                >Mensual</a
              >
            </div>
          </div>
          <div class="card-body">
            <div id="resumen-semanal">
              <div class="chart-container">
                <canvas id="chartSemanal"></canvas>
              </div>
              <div class="chart-stats">
                <p>
                  <strong>Tareas completadas esta semana:</strong>
                  <span id="totalSemanal">0</span>
                </p>
              </div>
            </div>
            <div id="resumen-mensual" style="display: none">
              <div class="chart-container">
                <canvas id="chartMensual"></canvas>
              </div>
              <div class="chart-stats">
                <p>
                  <strong>Tareas completadas este mes:</strong>
                  <span id="totalMensual">0</span>
                </p>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Columna derecha para escritorio -->
      <div class="right-column">
        <!-- Tarjeta de Bienvenida (En móvil aparece primero, en escritorio arriba a la derecha) -->
        <section class="card welcome-card">
          <div class="card-header">
            <h1>Bienvenido al Historial</h1>
          </div>
          <div class="card-body">
            <div class="welcome-content">
              <div class="welcome-text">
                <p>
                  Este es tu centro de productividad. Aquí puedes revisar cada
                  tarea que has completado y analizar tus estadísticas.
                </p>
                <p>¡Sigue así y alcanza nuevos niveles!</p>
              </div>
              <div class="welcome-image">
                <img
                  th:src="@{/images/icon1.png}"
                  alt="Ilustración de personaje"
                />
              </div>
            </div>
          </div>
        </section>

        <!-- Tarjeta de Estadísticas (En móvil aparece al final, en escritorio abajo de bienvenida) -->
        <aside class="card stats-card">
          <div class="card-header">
            <h2>Tus Estadísticas</h2>
          </div>
          <div class="card-body">
            <div class="stat-item">
              <div class="stat-icon-wrapper"><i class="bx bxs-trophy"></i></div>
              <div class="stat-text">
                <span class="stat-label">Tareas Completadas</span>
                <span class="stat-value" th:text="${usuario.numeroCompletadas}"
                  >0</span
                >
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon-wrapper"><i class="bx bxs-star"></i></div>
              <div class="stat-text">
                <span class="stat-label">Experiencia Total</span>
                <span
                  class="stat-value stat-value-xp"
                  th:text="${usuario.experienciaTotal} + ' XP'"
                  >0 XP</span
                >
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon-wrapper">
                <i class="bx bxs-chevrons-up"></i>
              </div>
              <div class="stat-text">
                <span class="stat-label">Nivel Actual</span>
                <span class="stat-value" th:text="${usuario.nivelExperiencia}"
                  >1</span
                >
              </div>
            </div>
            <div
              class="stat-item"
              th:classappend="${usuario.racha == 0 ? 'inactive' : ''}"
            >
              <div class="stat-icon-wrapper"><i class="bx bxs-hot"></i></div>
              <div class="stat-text">
                <span class="stat-label">Racha de Días</span>
                <span class="stat-value" th:text="${usuario.racha}">0</span>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <div th:replace="~{fragments :: navbar}"></div>

    <!-- Pantalla de carga -->
    <script th:src="@{/js/loader-main.js}"></script>
    <!-- Script para que los resúmenes puedan cambiar entre semanal y mensual -->
    <script th:src="@{/js/historial_tareas.js}"></script>
  </body>
</html>
